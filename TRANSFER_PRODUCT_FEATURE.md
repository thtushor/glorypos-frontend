# TransferProduct Feature Implementation

## Overview
A new feature has been added to the GloryPOS frontend that allows transferring (replicating) products to other shops. This enables users to copy an existing product with all its data to a different shop location, with a new auto-generated SKU/barcode.

## Files Created/Modified

### 1. Created: `TransferProduct.tsx`
**Location:** `src/components/shared/TransferProduct.tsx`

**Purpose:** A standalone component for transferring products to other shops.

**Key Features:**
- **Shop Selection:** Prominent dropdown to select target shop from SUB_SHOPS_URL API
- **Product Replication:** Copies all product data from the original product:
  - Name, description, category, brand, unit
  - Color, size, gender, model number
  - Pricing (purchase price, sales price, discount, VAT, final price)
  - Stock quantity and alert quantity
  - Product images (with ability to add/remove)
  - Status (active/inactive)
- **Auto-generated SKU:** The barcode/SKU field is disabled and will be auto-generated by the backend
- **Permissions:** Respects VIEW_COST_PROFIT and ADJUST_STOCK permissions
- **Variant Detection:** Shows notification if original product has variants
- **Visual Feedback:**
  - Highlighted shop selection section with brand colors
  - Shows original product info and SKU
  - Loading states during transfer
  - Image preview grid with remove functionality

**API Integration:**
- Fetches shops from `SUB_SHOPS_URL`
- Posts new product to `PRODUCT_URL` with `UserId` matching selected shop
- Fetches categories, brands, units, colors, sizes
- Supports product image uploads

### 2. Modified: `Products.tsx`
**Location:** `src/pages/inventory/Products.tsx`

**Changes Made:**
1. **Import Added:**
   - `FaExchangeAlt` icon from react-icons
   - `TransferProduct` component

2. **State Management:**
   - `isTransferModalOpen`: Controls transfer modal visibility
   - `transferProduct`: Stores the product being transferred

3. **New Handler:**
   ```typescript
   const handleTransfer = (product: Product) => {
     setTransferProduct(product);
     setIsTransferModalOpen(true);
   };
   ```

4. **UI Changes:**
   - Added Transfer button to product card action overlay
   - Button appears next to View, Edit, Delete buttons
   - Requires `CREATE_PRODUCT` permission
   - Blue hover effect to distinguish from other actions
   - Icon: Exchange/Transfer arrows (FaExchangeAlt)

5. **New Modal:**
   - Transfer Product Modal added below View Product Modal
   - Large width: `lg:!max-w-[80vw] !max-w-[95vw]`
   - Title: "Transfer Product to Another Shop"
   - Properly cleans up state on close

## How It Works

### User Flow:
1. User browses products in the Products page
2. Hovers over a product card to reveal action buttons
3. Clicks the blue "Transfer" button (exchange icon)
4. Transfer modal opens with:
   - Prominent shop selection dropdown (required field)
   - All product fields pre-filled from original
   - SKU field disabled (auto-generated)
   - Product images carried over
5. User selects target shop
6. User can optionally modify any product details
7. Clicks "Transfer Product" button
8. Product is created in selected shop with new SKU
9. Success toast notification
10. Products list refreshes

### Technical Flow:
1. `handleTransfer(product)` called with product data
2. `TransferProduct` component receives full `Product` object
3. Component initializes form with product data (except `id` and `sku`)
4. Fetches available shops from API
5. User selects shop and submits
6. Images uploaded if new files added
7. POST request to `PRODUCT_URL` with:
   - All product fields
   - `UserId` set to selected shop ID
   - `sku` set to empty string (backend generates)
8. Backend creates new product record
9. Frontend invalidates queries and shows success message

## Key Design Decisions

### 1. **Copy vs Reference**
- Products are fully copied (not referenced)
- Each shop gets independent inventory
- Original product unaffected by transfer

### 2. **SKU/Barcode Handling**
- Old SKU shown for reference
- New SKU auto-generated by backend
- User cannot manually set SKU during transfer
- Prevents duplicate barcode conflicts

### 3. **Permissions**
- Requires `CREATE_PRODUCT` permission to see transfer button
- Respects `VIEW_COST_PROFIT` for purchase price fields
- Respects `ADJUST_STOCK` for stock quantity editing

### 4. **Variants**
- Original variant data fetched but not transferred
- User notified if original has variants
- Variants must be added separately after transfer
- Prevents complex variant synchronization issues

### 5. **Images**
- Original images copied by URL reference
- User can add additional images during transfer
- User can remove unwanted images
- Multiple image support maintained

## API Requirements

### Endpoints Used:
- `GET ${BASE_URL}/sub-shops` - Fetch available shops
- `POST ${BASE_URL}/products` - Create new product in target shop
- `GET ${BASE_URL}/categories` - Fetch categories
- `GET ${BASE_URL}/brands` - Fetch brands
- `GET ${BASE_URL}/units` - Fetch units
- `GET ${BASE_URL}/colors` - Fetch colors
- `GET ${BASE_URL}/sizes` - Fetch sizes
- `GET ${BASE_URL}/product-variants` - Check for variants (optional)

### Expected Backend Behavior:
- Accept `UserId` field to assign product to specific shop
- Auto-generate unique SKU when `sku` is empty/null
- Handle image URLs (no re-upload needed for existing images)
- Validate shop ownership/permissions
- Return created product with new SKU in response

## Testing Checklist

- [ ] Transfer button appears on product cards
- [ ] Transfer button requires CREATE_PRODUCT permission
- [ ] Modal opens with all product data pre-filled
- [ ] Shop dropdown loads available shops
- [ ] Shop selection is required (validation)
- [ ] SKU field is disabled and shows placeholder
- [ ] Original product info displayed correctly
- [ ] All pricing calculations work correctly
- [ ] Images display and can be added/removed
- [ ] Purchase price hidden without VIEW_COST_PROFIT permission
- [ ] Stock field disabled without ADJUST_STOCK permission
- [ ] Variant notification shows for products with variants
- [ ] Transfer creates new product in selected shop
- [ ] New SKU generated automatically
- [ ] Success message displays
- [ ] Products list refreshes after transfer
- [ ] Modal closes and cleans up state
- [ ] Error handling for failed transfers
- [ ] Loading states display correctly

## Future Enhancements

1. **Bulk Transfer:** Transfer multiple products at once
2. **Variant Support:** Option to transfer variants along with product
3. **Stock Adjustment:** Set initial stock quantity for transferred product
4. **Transfer History:** Track which products were transferred where
5. **Price Adjustment:** Quick adjust prices during transfer
6. **Category Mapping:** Map categories between shops if different
7. **Transfer Confirmation:** Preview before final transfer
8. **Transfer Templates:** Save common transfer configurations

## Notes

- The feature does NOT move products (delete from original shop)
- Original product remains in the original shop unchanged
- This is a replication/duplication feature, not a migration
- Each transferred product is completely independent
- No ongoing synchronization between original and transferred products
